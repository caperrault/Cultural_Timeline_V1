<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 16px sans-serif;
  background-color: #000;
}

p {
  font-weight: 100;
}

.axis {
  fill: #fff;
}

.axis path,
.axis line {
  fill: none;
  stroke: none;
  shape-rendering: crispEdges;
}

#controlsFilm {
  font-size: 14px;
  position: absolute;
  top: 450px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsMusic {
  font-size: 14px;
  position: absolute;
  top: 475px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsTv {
  font-size: 14px;
  position: absolute;
  top: 500px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsAdvertising {
  font-size: 14px;
  position: absolute;
  top: 525px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsArt {
  font-size: 14px;
  position: absolute;
  top: 550px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsBook {
  font-size: 14px;
  position: absolute;
  top: 575px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsEntertainment {
  font-size: 14px;
  position: absolute;
  top: 600px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsEvent {
  font-size: 14px;
  position: absolute;
  top: 625px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsFashionRetail {
  font-size: 14px;
  position: absolute;
  top: 650px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsIcons {
  font-size: 14px;
  position: absolute;
  top: 675px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsMedia {
  font-size: 14px;
  position: absolute;
  top: 700px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsPolitics {
  font-size: 14px;
  position: absolute;
  top: 725px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsSocialMovements {
  font-size: 14px;
  position: absolute;
  top: 750px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

#controlsTech {
  font-size: 14px;
  position: absolute;
  top: 775px;
  left: 20px;
  color: white;
  font: 10px sans-serif;
}

input {
  margin: 4px 4px 0;
}

div.mapTooltip {
  width: 250px;
  position: absolute;
  text-align: left;
  color: white;
  padding: 0;
  font-size: 12px;
  font-family: Helvetica, Arial, inherit;
  font-weight: bold;
  background: #444;
  border: 0;
  pointer-events: none;
  display : block;
}

.displayed {
  display: inline;
}

.displayed :hover {
  opacity: 0.5;
}

.notDisplayed {
  display: none;
}

</style>

<body>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script>

var margin = {top: 20, right: 20, bottom: 30, left: 100},
    width = 1400 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom,
    padding = 1,
    radius = 16;

// var zoom = d3.behavior.zoom()
//         .scaleExtent([1, 10])
//         .on("zoom", zoomed);

var x = d3.scale.linear()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height, 70]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("top")
    .tickFormat(d3.format(""));

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    // .call(zoom);

var div = d3.select("body").append("div")
              .attr("class", "mapTooltip")
              .style("opacity", 0);

var controlsFilm = d3.select("body").append("label")
    .attr("id", "controlsFilm");

var checkboxFilm = controlsFilm.append("input")
    .attr("type", "checkbox")
    .property("checked", true);
controlsFilm.append("span")
    .text("Film");

var controlsMusic = d3.select("body").append("label")
        .attr("id", "controlsMusic");

var checkboxMusic = controlsMusic.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsMusic.append("span")
        .text("Music");

var controlsTv = d3.select("body").append("label")
        .attr("id", "controlsTv");

var checkboxTv = controlsTv.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsTv.append("span")
        .text("Tv");

var controlsAdvertising = d3.select("body").append("label")
        .attr("id", "controlsAdvertising");

var checkboxAdvertising = controlsAdvertising.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsAdvertising.append("span")
        .text("Advertising");

var controlsArt = d3.select("body").append("label")
        .attr("id", "controlsArt");

var checkboxArt = controlsArt.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsArt.append("span")
        .text("Art");

var controlsBook = d3.select("body").append("label")
        .attr("id", "controlsBook");

var checkboxBook = controlsBook.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsBook.append("span")
        .text("Literature");

var controlsEntertainment = d3.select("body").append("label")
        .attr("id", "controlsEntertainment");

var checkboxEntertainment = controlsEntertainment.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsEntertainment.append("span")
        .text("Entertainment");

var controlsEvent = d3.select("body").append("label")
        .attr("id", "controlsEvent");

var checkboxEvent = controlsEvent.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsEvent.append("span")
        .text("Event");

var controlsFashionRetail = d3.select("body").append("label")
        .attr("id", "controlsFashionRetail");

var checkboxFashionRetail = controlsFashionRetail.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsFashionRetail.append("span")
        .text("Fashion / Retail");

var controlsIcons = d3.select("body").append("label")
        .attr("id", "controlsIcons");

var checkboxIcons = controlsIcons.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsIcons.append("span")
        .text("Icons");

var controlsMedia = d3.select("body").append("label")
        .attr("id", "controlsMedia");

var checkboxMedia = controlsMedia.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsMedia.append("span")
        .text("Media");

var controlsPolitics = d3.select("body").append("label")
        .attr("id", "controlsPolitics");

var checkboxPolitics = controlsPolitics.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsPolitics.append("span")
        .text("Politics");

var controlsSocialMovements = d3.select("body").append("label")
        .attr("id", "controlsSocialMovements");

var checkboxSocialMovements = controlsSocialMovements.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsSocialMovements.append("span")
        .text("Social Movements");

var controlsTech = d3.select("body").append("label")
        .attr("id", "controlsTech");

var checkboxTech = controlsTech.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsTech.append("span")
        .text("Technology");

x.domain([1980,2019]);
y.domain([0,9]);

svg.append("g")
   .attr("class", "x axis")
   .attr("transform", "translate(0,100)")
   .call(xAxis)

var xVar = "YEAR",
    node;

function draw(nodes) {

          var force = d3.layout.force()
            .nodes(nodes)
            .size([width, height])
            .on("tick", tick)
            .charge(-0.01)
            .gravity(0)
            .start();

            // Set initial positions
          nodes.forEach(function(d) {
              // d.x = x(d[xVar]);
              // d.y = y(d[yVar-1]);
              d.radius = radius;
            });

          var node = svg.selectAll(".node")
                        .data(nodes);

          node.enter().append("g")
                  .attr("class", "node")
                  .call(force.drag);

          node.append("image")
              .attr("xlink:href", function(d) { return d.IMAGE; })
              .attr("x", -8)
              .attr("y", -8)
              .attr("width", 30)
              .attr("height", 30)
              .style("cursor", "pointer")
              .on("click", function(d) {
                                 div.transition().duration(300).style("opacity", 1);
                                //  div.html("<img src=" + d.IMAGE + " width=250 > <br><p style = padding-left:5px;font-weight:bold>"  + d.TITLE + " (" + d.YEAR + ")</p><p style = padding-left:5px;font-size:10>" + d.DESCRIPTION + "</p><a href='" + d.SOURCE + "' style=padding-left:5px;text-decoration:underline;font-size:10;>Source</a>")
                                 div.html("<img src=" + d.IMAGE + " width=250 > <br><p style = padding-left:5px;font-weight:bold>"  + d.TITLE + " (" + d.YEAR + ")</p><p style = padding-left:5px;font-size:10>" + d.DESCRIPTION + "</p><p style=padding-left:5px;text-decoration:underline;font-size:10;>Source</p>")
                                 .style("left", (d3.event.pageX) + "px")
                                 .style("top", (d3.event.pageY-10) + "px");
                              })
              .on("mouseout", function (d) { div.transition().delay(1500).duration(300).style("opacity", 0);});

        node.exit().remove();

        function tick(e) {
          node.each(moveTowardDataPosition(e.alpha));
          node.each(collide(e.alpha));
          node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
        }

        function moveTowardDataPosition(alpha) {
          return function(d) {
            d.x += (x(d[xVar]) - d.x) * 0.1 * alpha;
            //controls y height
            d.y += (220 - d.y) * 0.1 * alpha;
          };
        }

        // Resolve collisions between nodes.
        function collide(alpha) {
          var quadtree = d3.geom.quadtree(nodes);
          return function(d) {
            var r = d.radius + radius + padding,
                nx1 = d.x - r,
                nx2 = d.x + r,
                ny1 = d.y - r,
                ny2 = d.y + r;
            quadtree.visit(function(quad, x1, y1, x2, y2) {
              if (quad.point && (quad.point !== d)) {
                var x = d.x - quad.point.x,
                    y = d.y - quad.point.y,
                    l = Math.sqrt(x * x + y * y),
                    r = d.radius + quad.point.radius + padding;
                if (l < r) {
                  l = (l - r) / l * alpha;
                  d.x -= x *= l;
                  d.y -= y *= l;
                  quad.point.x += x;
                  quad.point.y += y;
                }
              }
              return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
            });
          };
        }
}

d3.csv("CultureFresco2.csv", function(error, data) {

  var musicData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Music" })
    , filmData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Film" })
    , tvData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Tv" })
    , advertisingData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Advertising" })
    , artData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Art" })
    , bookData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Book" })
    , entertainmentData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Entertainment" })
    , eventData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Event" })
    , fashionRetailData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Fashion / Retail" })
    , iconsData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Icons" })
    , mediaData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Media" })
    , politicsData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Politics" })
    , socialMovementsData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Social Movements" })
    , techData = data.filter(function(d, i) { return d.PRIMARYCATEGORY === "Tech" });

  function update() {

    var film = checkboxFilm.node().checked
      , music = checkboxMusic.node().checked
      , tv = checkboxTv.node().checked
      , advertising = checkboxAdvertising.node().checked
      , art = checkboxArt.node().checked
      , book = checkboxBook.node().checked
      , entertainment = checkboxEntertainment.node().checked
      , events = checkboxEvent.node().checked
      , fashionRetail = checkboxFashionRetail.node().checked
      , icons = checkboxIcons.node().checked
      , media = checkboxMedia.node().checked
      , politics = checkboxPolitics.node().checked
      , socialMovements = checkboxSocialMovements.node().checked
      , tech = checkboxTech.node().checked
      , list = [];

    if (film) {
      list = list.concat(filmData);
    }
    if (music) {
      list = list.concat(musicData)
    }
    if (tv) {
      list = list.concat(tvData)
    }
    if (advertising) {
      list = list.concat(advertisingData)
    }
    if (art) {
      list = list.concat(artData)
    }
    if (book) {
      list = list.concat(bookData)
    }
    if (entertainment) {
      list = list.concat(entertainmentData)
    }
    if (events) {
      list = list.concat(eventData)
    }
    if (fashionRetail) {
      list = list.concat(fashionRetailData)
    }
    if (icons) {
      list = list.concat(iconsData)
    }
    if (media) {
      list = list.concat(mediaData)
    }
    if (politics) {
      list = list.concat(politicsData)
    }
    if (socialMovements) {
      list = list.concat(socialMovementsData)
    }
    if (tech) {
      list = list.concat(techData)
    }

    draw(list);

  }

  d3.select("#controlsFilm").on("change", update);
  d3.select("#controlsMusic").on("change", update);
  d3.select("#controlsTv").on("change", update);
  d3.select("#controlsAdvertising").on("change", update);
  d3.select("#controlsArt").on("change", update);
  d3.select("#controlsBook").on("change", update);
  d3.select("#controlsEntertainment").on("change", update);
  d3.select("#controlsEvent").on("change", update);
  d3.select("#controlsFashionRetail").on("change", update);
  d3.select("#controlsIcons").on("change", update);
  d3.select("#controlsMedia").on("change", update);
  d3.select("#controlsPolitics").on("change", update);
  d3.select("#controlsSocialMovements").on("change", update);
  d3.select("#controlsTech").on("change", update);

  draw(musicData.concat(filmData).concat(tvData).concat(advertisingData).concat(artData).concat(bookData).concat(entertainmentData).concat(eventData).concat(fashionRetailData).concat(iconsData).concat(mediaData).concat(politicsData).concat(socialMovementsData).concat(techData));

});

// function zoomed() {
// svg.attr("transform", "scale(" + d3.event.scale + ")");
// }

</script>
