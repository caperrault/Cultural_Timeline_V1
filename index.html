<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 16px sans-serif;
  background-color: #000;
}

h1 {
  color: #fff;
  margin-left: 85px;
  margin-top: 60px;
  margin-bottom: -20px;
  font-size: 30px;
  font-weight: 300;
  cursor: default;
}

p {
  font-weight: 100;
}

.x1_axis text {
  fill: #fff;
  cursor: default;
}

.x2_axis text {
  fill: #fff;
  font-weight: 100;
  font-size: 10px;
  text-align: left;
}

.x2_axis path,
.x2_axis line {
  fill: none;
  stroke: none;
  /*stroke-width: 1;*/
  shape-rendering: crispEdges;
}

.x2_axis text:hover {
  fill: red;
}

#backButton {
    float:right;
    color:white;
    font-size:10px;
    padding-right: 192px;
    padding-top: 70px;
    cursor: pointer;
}

#backButton:hover {
  color: red;
}

.node {
  cursor: default;
}

.nodeVisible:hover {
  opacity: 0.5;
  cursor: pointer;
}

#controlsFilm {
  position: absolute;
  top: 625px;
  left: 85px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

#controlsMusic {
  position: absolute;
  top: 650px;
  left: 85px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

#controlsArtLiterature {
  position: absolute;
  top: 675px;
  left: 85px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

#controlsTvEntertainmentMedia {
  position: absolute;
  top: 625px;
  left: 250px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

#controlsAdvertising {
  position: absolute;
  top: 650px;
  left: 250px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

#controlsFashionRetail {
  position: absolute;
  top: 675px;
  left: 250px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

#controlsPoliticsSocialMovements {
  position: absolute;
  top: 625px;
  left: 413px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

#controlsTech {
  position: absolute;
  top: 650px;
  left: 413px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

#controlsIcons {
  position: absolute;
  top: 675px;
  left: 413px;
  color: white;
  font: 10px sans-serif;
  cursor: pointer;
}

input {
  margin: 4px 4px 0;
  cursor: pointer;
}

div.mapTooltip1 {
  width: 250px;
  position: absolute;
  text-align: left;
  color: white;
  padding: 0;
  font-size: 12px;
  font-family: Helvetica, Arial, inherit;
  font-weight: bold;
  background: #444;
  border: 0;
  pointer-events: none;
  display : block;
}

div.mapTooltip2 {
  position: absolute;
  text-align: center;
  color: white;
  height: 20px;
  padding: 10px 10px 2px 10px;
  font-size: 10px;
  font-weight: bold;
  background: #444;
  border: 3px;
  border-radius: 2px;
  pointer-events: none;
}

.displayed {
  opacity: 1;
}

.notDisplayed {
  opacity: 0;
}

#themesTitle {
  position: absolute;
  top: 620px;
  left: 909px;
  color: white;
  font: 10px sans-serif;
  cursor: default;
}

#viewAllThemes {
  position: absolute;
  top: 645px;
  left: 909px;
  color: white;
  font: 10px sans-serif;
  cursor: default;
  font-style: italic;
  cursor: pointer;
}

#viewAllThemes:hover {
  color: red;
}

.themes {
  font-size: 14px;
  position: absolute;
  color: white;
  font: 10px sans-serif;
  left: 1010px;
  cursor: pointer;
}

#theme1 {
  top: 620px;
}

#theme2 {
  top: 645px;
}

#theme3 {
  top: 670px;
}

.themes:hover {
  color: red;
}

</style>

<body>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<h1 style="float:left"> AKQA Timeline </h1>

<p id="backButton" class="notDisplayed"> Back to initial scale </p>

<p id="themesTitle" > Themes over time: </p>

<p id="viewAllThemes" > (View all themes) </p>

<p id="theme1" class="themes"> Theme 1 </p>

<p id="theme2" class="themes"> Theme 2 </p>

<p id="theme3" class="themes"> Theme 3 </p>

<script>

var margin = {top: 0, right: 20, bottom: 30, left: 100},
    width = 1400 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom,
    padding = 1,
    radius = 16;

var x1 = d3.scale.linear()
    .range([0, width]);

var x2 = d3.scale.ordinal()
    .rangePoints([0, width-130]);

var y = d3.scale.linear()
    .range([height, 70]);

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var controlsFilm = d3.select("body").append("label")
    .attr("id", "controlsFilm");

var checkboxFilm = controlsFilm.append("input")
    .attr("type", "checkbox")
    .property("checked", true);
controlsFilm.append("span")
    .text("Film");

var controlsMusic = d3.select("body").append("label")
        .attr("id", "controlsMusic");

var checkboxMusic = controlsMusic.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsMusic.append("span")
        .text("Music");

var controlsTvEntertainmentMedia = d3.select("body").append("label")
        .attr("id", "controlsTvEntertainmentMedia");

var checkboxTvEntertainmentMedia = controlsTvEntertainmentMedia.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsTvEntertainmentMedia.append("span")
        .text("Tv / Entertainment / Media");

var controlsAdvertising = d3.select("body").append("label")
        .attr("id", "controlsAdvertising");

var checkboxAdvertising = controlsAdvertising.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsAdvertising.append("span")
        .text("Advertising");

var controlsArtLiterature = d3.select("body").append("label")
        .attr("id", "controlsArtLiterature");

var checkboxArtLiterature = controlsArtLiterature.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsArtLiterature.append("span")
        .text("Art / Literature");

var controlsFashionRetail = d3.select("body").append("label")
        .attr("id", "controlsFashionRetail");

var checkboxFashionRetail = controlsFashionRetail.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsFashionRetail.append("span")
        .text("Fashion / Retail");

var controlsIcons = d3.select("body").append("label")
        .attr("id", "controlsIcons");

var checkboxIcons = controlsIcons.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsIcons.append("span")
        .text("Icons");

var controlsPoliticsSocialMovements = d3.select("body").append("label")
        .attr("id", "controlsPoliticsSocialMovements");

var checkboxPoliticsSocialMovements = controlsPoliticsSocialMovements.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsPoliticsSocialMovements.append("span")
        .text("Politics / Social Movements");

var controlsTech = d3.select("body").append("label")
        .attr("id", "controlsTech");

var checkboxTech = controlsTech.append("input")
        .attr("type", "checkbox")
        .property("checked", true);
controlsTech.append("span")
        .text("Technology");

var div1 = d3.select("body").append("div")
              .attr("class", "mapTooltip1")
              .style("opacity", 0);

var div2 = d3.select("body").append("div")
              .attr("class", "mapTooltip2")
              .style("opacity", 0);

var xVar = "YEAR",
    node,
    selectedTheme = "all";
    //list = [];

d3.select("#viewAllThemes").attr("class", "notDisplayed");

d3.csv("CultureFresco2_2.csv", function(error, data) {

  var clickedAxisLabel;

  var x1Axis = d3.svg.axis()
      .scale(x1)
      .ticks(10)
      .orient("top")
      .tickFormat(d3.format(""));

    x1.domain([1980,2019]);

    var x2Axis = d3.svg.axis()
        .scale(x2)
        .ticks(30)
        .orient("top");

    x2.domain(["'A material world'","'The rise of Gen X'","'The World Wide Web'","'Looking into the Matrix'","'Age of dark truth'","'Age of togetherness'","'Going to other worlds'","'To be devised'"]);

      svg.append("g")
         .attr("class", "x1_axis")
         .attr("transform", "translate(0,100)")
         .call(x1Axis)
       .selectAll("text")
        .attr("x", -20)
        .style("text-anchor", "start");

       svg.append("g")
          .attr("class", "x2_axis")
          .attr("transform", "translate(0,120)")
          .attr("text-anchor", "end")
          .call(x2Axis)
        .selectAll("text")
         .attr("x", -20)
         .attr("class", "x2TickLabels")
         .style("cursor", "pointer")
         .style("text-anchor", "start")

         svg.selectAll(".x2TickLabels")
         .on("click", function(d) {
           d3.select("#backButton").attr("class", "displayed");
           clickAxis(d);
           clickedAxisLabel = d;
           console.log("clickedAxisLabel", clickedAxisLabel)
         });

         d3.select("#backButton")
           .on("click", function(d) {

             d3.select("#backButton").attr("class", "notDisplayed");

                        x1.range([-15, width-20])
                        .domain([1980,2019]);

                       x2.rangePoints([-15, width-155])
                        .domain(["'A material world'","'The rise of Gen X'","'The World Wide Web'","'Looking into the Matrix'","'Age of dark truth'","'Age of togetherness'","'Going to other worlds'","'To be devised'"]);

                       x1Axis.ticks(10);
                       x2Axis.ticks(30);

                       svg.select(".x1_axis") // change the x axis
                         .transition().duration(200).ease("sin-in-out")
                         .call(x1Axis);

                      svg.select(".x1_axis")
                         .selectAll("text")
                         .attr("x", -20)
                         .style("text-anchor", "start"); // change the x axis;

                       svg.select(".x2_axis")
                         .transition().duration(200).ease("sin-in-out")
                         .call(x2Axis);

                      svg.select(".x2_axis")
                         .selectAll("text")
                         .attr("x", -2000)
                         .attr("class", "x2TickLabels")
                         .style("cursor", "pointer")
                         .style("text-anchor", "start");

                       svg.selectAll(".x2TickLabels")
                      .on("click", function(d) { clickAxis(d);});

                      update();

                     }
                   )

      function redrawAxis (axisLabel) {

           d3.select("#backButton").attr("class", "displayed");

             var domainX1 , domainX2;

             x1.range([-15, width-125]);
             x2.rangePoints([-15, width-150]);

             x1Axis.ticks(5);
             x2Axis.ticks(3);

             if (axisLabel === "'A material world'") {
                     domainX1 = [1980,1985.1];
                     domainX2 = ["'A material world'","'The rise of Gen X'"];
             }

             if (axisLabel === "'The rise of Gen X'") {
                     domainX1 = [1985,1990.1];
                     domainX2 = ["'The rise of Gen X'","'The World Wide Web'"];
              }

             if (axisLabel === "'The World Wide Web'") {
                     domainX1 = [1990,1995.1];
                     domainX2 = ["'The World Wide Web'","'Looking into the Matrix'"];
             }

             if (axisLabel === "'Looking into the Matrix'") {
                      domainX1 = [1995,2000.1];
                      domainX2 = ["'Looking into the Matrix'","'Age of dark truth'"];
              }

             if (axisLabel === "'Age of dark truth'") {
                       domainX1 = [2000,2005.1];
                       domainX2 = ["'Age of dark truth'","'Age of togetherness'"];
               }

             if (axisLabel === "'Age of togetherness'") {
                        domainX1 = [2005,2010.1];
                        domainX2 = ["'Age of togetherness'","'Going to other worlds'"];
              }

             if (axisLabel === "'Going to other worlds'") {
                       domainX1 = [2010,2015.1];
                       domainX2 = ["'Going to other worlds'","'To be devised'"];
             }

              if (axisLabel === "'To be devised'") {
             domainX1 = [2010,2015.1];
             domainX2 = ["'Going to other worlds'","'To be devised'"];
                }

           x1.domain(domainX1);
           x2.domain(domainX2);

               svg.select(".x1_axis") // change the x axis
                 .transition().duration(200).ease("sin-in-out")
                 .call(x1Axis);

               svg.select(".x1_axis")
                 .selectAll("text")
                 .attr("x", -20)
                 .style("text-anchor", "start"); // change the x axis;

               svg.select(".x2_axis")
                 .transition().duration(200).ease("sin-in-out")
                 .call(x2Axis);

               svg.select(".x2_axis")
                 .selectAll("text")
                 .attr("x", -20)
                 .attr("class","x2TickLabels")
                 .style("cursor", "pointer")
                 .style("text-anchor", "start");

         update();
       };

       function clickAxis (axisLabel) {

         redrawAxis(axisLabel);

         svg.selectAll(".x2TickLabels")
         .on("click", function(axisLabel) {
           clickedAxisLabel = axisLabel;
           console.log("new clickedAxisLabel", clickedAxisLabel);
           clickAxis(clickedAxisLabel);
         });

       };

  var musicData = data.filter(function(d) { return d.PRIMARYCATEGORY === "Music" })
    , filmData = data.filter(function(d) { return d.PRIMARYCATEGORY === "Film" })
    , artLiteratureData = data.filter(function(d) { return d.PRIMARYCATEGORY === "ArtLiterature" })
    , tvEntertainmentMediaData = data.filter(function(d) { return d.PRIMARYCATEGORY === "TvEntertainmentMedia" })
    , advertisingData = data.filter(function(d) { return d.PRIMARYCATEGORY === "Advertising" })
    , fashionRetailData = data.filter(function(d) { return d.PRIMARYCATEGORY === "FashionRetail" })
    , politicsSocialMovementsData = data.filter(function(d) { return d.PRIMARYCATEGORY === "PoliticsSocialMovements" })
    , techData = data.filter(function(d) { return d.PRIMARYCATEGORY === "Tech" })
    , iconsData = data.filter(function(d) { return d.PRIMARYCATEGORY === "Icons" });

  function update() {

    var film = checkboxFilm.node().checked
      , music = checkboxMusic.node().checked
      , artLiterature = checkboxArtLiterature.node().checked
      , tvEntertainmentMedia = checkboxTvEntertainmentMedia.node().checked
      , advertising = checkboxAdvertising.node().checked
      , fashionRetail = checkboxFashionRetail.node().checked
      , politicsSocialMovements = checkboxPoliticsSocialMovements.node().checked
      , tech = checkboxTech.node().checked
      , icons = checkboxIcons.node().checked
      , list = [];

    if (film) {
      list = list.concat(filmData);
    }
    if (music) {
      list = list.concat(musicData);
    }
    if (tvEntertainmentMedia) {
      list = list.concat(tvEntertainmentMediaData);
    }
    if (advertising) {
      list = list.concat(advertisingData);
    }
    if (artLiterature) {
      list = list.concat(artLiteratureData);
    }
    if (fashionRetail) {
      list = list.concat(fashionRetailData);
    }
    if (politicsSocialMovements) {
      list = list.concat(politicsSocialMovementsData);
    }
    if (tech) {
      list = list.concat(techData);
    }
    if (icons) {
      list = list.concat(iconsData);
    }

    draw(list);
  //  console.log(list);
  }

  d3.select("#controlsFilm").on("change", update);
  d3.select("#controlsMusic").on("change", update);
  d3.select("#controlsTvEntertainmentMedia").on("change", update);
  d3.select("#controlsAdvertising").on("change", update);
  d3.select("#controlsArtLiterature").on("change", update);;
  d3.select("#controlsFashionRetail").on("change", update);
  d3.select("#controlsIcons").on("change", update);
  d3.select("#controlsPoliticsSocialMovements").on("change", update);
  d3.select("#controlsTech").on("change", update);

  draw(musicData.concat(filmData).concat(tvEntertainmentMediaData).concat(advertisingData).concat(artLiteratureData).concat(fashionRetailData).concat(iconsData).concat(politicsSocialMovementsData).concat(techData));

});

function draw(nodes) {

          var force = d3.layout.force()
            .nodes(nodes)
            .size([width, height])
            .on("tick", tick)
            .charge(-0.01)
            .gravity(0)
            .start();

        function tick(e) {

          // Set initial positions
        nodes.forEach(function(d) {
            // d.x = x(d[xVar]);
            // d.y = y(d[yVar-1]);
            d.RADIUS = radius;
          });

          var node = svg.selectAll(".node")
                        .data(nodes, function(d) {return d.IMAGE;});

          var newNode = node.enter().append("g")
                  .classed("nodeVisible", true)
                  .classed("node", true)
                  .call(force.drag);

              newNode
              // .classed("nodeVisible", function (d) {
              //           if (d.THEME === selectedTheme) {return true;}
              //           else if (selectedTheme === "all") {return true;}
              //           else {return false;}
              //         })
                      .on("mouseover", function(d) {
                      if (d.THEME === selectedTheme) {
                        div2.transition().duration(300).style("opacity", 1);
                        div2.text(d.TITLE + " (" + d.YEAR + ")")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY-10) + "px");}

                      else if (selectedTheme === "all") {
                        div2.transition().duration(300).style("opacity", 1);
                        div2.text(d.TITLE + " (" + d.YEAR + ")")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY-10) + "px");
                      }
                        })
                      .on("click", function(d) {
                        if (d.THEME === selectedTheme) {
                           div1.transition().duration(300).style("opacity", 1);
                           div1.html("<img src=" + d.IMAGE + " width=250 > <br><p style = padding-left:5px;font-weight:bold>"  + d.TITLE + " (" + d.YEAR + ")</p><p style = padding-left:5px;font-size:10>" + d.DESCRIPTION + "</p><p style=padding-left:5px;text-decoration:underline;font-size:10;>Source</p>")
                           .style("left", (d3.event.pageX) + "px")
                           .style("top", (d3.event.pageY-10) + "px");
                           //console.log(list.length);
                         }

                         else if (selectedTheme === "all") {
                           div1.transition().duration(300).style("opacity", 1);
                           div1.html("<img src=" + d.IMAGE + " width=250 > <br><p style = padding-left:5px;font-weight:bold>"  + d.TITLE + " (" + d.YEAR + ")</p><p style = padding-left:5px;font-size:10>" + d.DESCRIPTION + "</p><p style=padding-left:5px;text-decoration:underline;font-size:10;>Source</p>")
                           .style("left", (d3.event.pageX) + "px")
                           .style("top", (d3.event.pageY-10) + "px");
                           //console.log(list.length);
                         }
                        })
                      .on("mouseout", function (d) {
                        div1.transition().delay(1500).duration(300).style("opacity", 0);
                        div2.transition().duration(300).style("opacity", 0);
                      });
                    //  .attr("class", "nodeVisible");

              newNode.append("image")
                  .attr("xlink:href", function(d) { return d.IMAGE; })
                  .attr("x", -8)
                  .attr("y", -8)
                  .attr("width", 30)
                  .attr("height", 30);

        node.exit().remove();

          node.each(moveTowardDataPosition(e.alpha));
          node.each(collide(e.alpha));
          node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

          d3.select("#theme1")
            .on("click", function () {
                              d3.select("#viewAllThemes").attr("class", "displayed");
                              d3.select("#theme1").style("color", "red");
                              d3.select("#theme2").style("color", "white");
                              d3.select("#theme3").style("color", "white");
                              selectedTheme = "theme1";
                              console.log("selectedTheme:", selectedTheme);
                              node.transition().duration(450).attr("opacity", function(d) {
                                if (d.THEME === "theme1") { return 1; }
                                else { return 0.05; }
                              });
                              node.classed("nodeVisible", function(d) {
                                if (d.THEME === "theme1") { return true; }
                                else { return false; }
                              });
                  //              .attr("class", function);
                            });

          d3.select("#theme2")
            .on("click", function () {
                            d3.select("#viewAllThemes").attr("class", "displayed");
                            d3.select("#theme2").style("color", "red");
                            d3.select("#theme1").style("color", "white");
                            d3.select("#theme3").style("color", "white");
                            selectedTheme = "theme2";
                            console.log("selectedTheme:", selectedTheme);
                            node.transition().duration(450).attr("opacity", function(d) {
                              if (d.THEME === "theme2") { return 1;}
                              else { return 0.05; }
                            });
                            node.classed("nodeVisible", function(d) {
                              if (d.THEME === "theme2") { return true; }
                              else { return false; }
                            });
            });

          d3.select("#theme3")
            .on("click", function () {
                            d3.select("#viewAllThemes").attr("class", "displayed");
                            d3.select("#theme3").style("color", "red");
                            d3.select("#theme1").style("color", "white");
                            d3.select("#theme2").style("color", "white");
                            selectedTheme = "theme3";
                            console.log("selectedTheme:", selectedTheme);
                            node.transition().duration(450).attr("opacity", function(d) {
                              if (d.THEME === "theme3") { return 1;}
                              else { return 0.05; }
                           });
                           node.classed("nodeVisible", function(d) {
                             if (d.THEME === "theme3") { return true; }
                             else { return false; }
                           });
                        });

          d3.select("#viewAllThemes")
            .on("click", function () {
                            d3.select("#viewAllThemes").attr("class", "notDisplayed");
                            d3.selectAll(".themes").style("color", "white");
                            selectedTheme = "all";
                            console.log("selectedTheme:", selectedTheme);
                            node.transition().duration(450).attr("opacity", 1);
                            node.classed("nodeVisible", true );
                        });
        }

        function moveTowardDataPosition(alpha) {
          return function(d) {
            d.x += (x1(d[xVar]) - d.x) * 0.1 * alpha;
            //controls y height
            d.y += (300 - d.y) * 0.1 * alpha;
          };
        }

        // Resolve collisions between nodes.
        function collide(alpha) {
          var quadtree = d3.geom.quadtree(nodes);
          return function(d) {
            var r = d.RADIUS + radius + padding,
                nx1 = d.x - r,
                nx2 = d.x + r,
                ny1 = d.y - r,
                ny2 = d.y + r;
            quadtree.visit(function(quad, x1, y1, x2, y2) {
              if (quad.point && (quad.point !== d)) {
                var x = d.x - quad.point.x,
                    y = d.y - quad.point.y,
                    l = Math.sqrt(x * x + y * y),
                    r = d.RADIUS + quad.point.RADIUS + padding;
                if (l < r) {
                  l = (l - r) / l * alpha;
                  d.x -= x *= l;
                  d.y -= y *= l;
                  quad.point.x += x;
                  quad.point.y += y;
                }
              }
              return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
            });
          };
        }

}

</script>
